<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Match Machine</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#1e1e1e; color:#fff; padding:20px; }
button{ padding:10px 15px; margin:5px; border:none; border-radius:6px; cursor:pointer; }
.start-btn{ background:#0a7cff; color:#fff; }
.stop-btn{ background:#ff0000; color:#fff; }
.goal-btn{ background:#28a745; color:#fff; }
.status{ margin-top:10px; font-size:18px; font-weight:bold; }
.scoreboard{ background:#2c2c2c; padding:15px; border-radius:10px; margin-bottom:20px; }
.scoreboard div{ margin:5px 0; }
</style>
</head>
<body>

<h2>Match Machine (Admin Panel)</h2>

<div class="scoreboard">
  <div>Time: <span id="minute">0</span>'</div>
  <div>Score: <span id="scoreCPE">0</span> - <span id="scoreBMG">0</span></div>
  <div>Status: <span id="status">Not started</span></div>
</div>

<label>Set Match Duration (minutes):</label>
<input type="number" id="matchDuration" value="15" min="1" style="width:60px;">
<button class="start-btn" id="startMatch">Start Match</button>
<button class="stop-btn" id="stopMatch">Stop Match</button>

<div style="margin-top:15px;">
  <button class="goal-btn" onclick="addGoal('CPE')">Add Goal CPE</button>
  <button class="goal-btn" onclick="addGoal('BMG')">Add Goal BMG</button>
</div>

<script>
let interval;
let matchDuration = parseInt(document.getElementById("matchDuration").value);
let currentMinute = 0;
let score = {CPE:0, BMG:0};
let statusEl = document.getElementById("status");

// --- Load bets ---
let activeBets = JSON.parse(localStorage.getItem("activeBets")) || [];

// --- Start match ---
document.getElementById("startMatch").addEventListener("click", ()=>{
    matchDuration = parseInt(document.getElementById("matchDuration").value);
    currentMinute = 0;
    statusEl.innerText = "In-Play";
    interval = setInterval(()=>{
        if(currentMinute < matchDuration){
            currentMinute++;
            document.getElementById("minute").innerText = currentMinute;
            updateOdds();
        } else {
            statusEl.innerText = "Half-Time / End";
            clearInterval(interval);
        }
    },2000); // 1 min = 2 sec simulation
});

// --- Stop match ---
document.getElementById("stopMatch").addEventListener("click", ()=>{
    clearInterval(interval);
    statusEl.innerText = "Stopped";
});

// --- Add Goal (password protected) ---
function addGoal(team){
    const pwd = prompt("Enter admin password:");
    if(pwd !== "admin123"){ alert("Wrong password"); return; }
    score[team]++;
    document.getElementById("scoreCPE").innerText = score.CPE;
    document.getElementById("scoreBMG").innerText = score.BMG;
    updateOdds();
}

// --- Update odds dynamically based on score and time ---
function updateOdds(){
    activeBets.forEach(b=>{
        // Adjust odds: simple model
        let odds = b.originalOdd;
        if(score[b.team] > 0) odds = Math.max(1.01, odds - 0.2*score[b.team]); // leading team odds decrease
        else odds = odds + 0.1; // losing team odds increase
        b.currentOdd = parseFloat(odds.toFixed(2));

        // Update minute for display
        b.minute = currentMinute;
    });
    localStorage.setItem("activeBets",JSON.stringify(activeBets));
}
</script>

</body>
</html>
