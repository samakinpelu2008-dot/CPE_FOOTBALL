<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CPE Live Match</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f0f2f5;
}

/* SCOREBOARD */
#scoreboard {
  background: #fff;
  padding: 15px;
  text-align: center;
  border-bottom: 1px solid #ddd;
}

.teams {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.team {
  width: 40%;
  text-align: center;
}

.team img {
  width: 48px;
  height: 48px;
  object-fit: contain;
}

.score {
  font-size: 32px;
  font-weight: bold;
}

#middleInfo {
  margin-top: 8px;
  font-size: 14px;
  color: #666;
}

/* TIMELINE */
#timeline {
  padding: 10px;
  font-size: 13px;
}

/* CHAT */
#chat {
  height: 45vh;
  overflow-y: auto;
  padding: 10px;
}

.message-wrap {
  display: flex;
  margin: 6px 0;
}

.msg {
  padding: 10px 14px;
  border-radius: 16px;
  max-width: 70%;
  font-size: 14px;
}

.left {
  background: #fff;
  margin-right: auto;
}

.right {
  background: #0084ff;
  color: white;
  margin-left: auto;
}

.menu {
  margin-left: 6px;
  cursor: pointer;
}

.delete {
  font-size: 12px;
  color: red;
  cursor: pointer;
}

/* INPUT */
#inputArea {
  display: flex;
  padding: 10px;
  background: #fff;
  border-top: 1px solid #ddd;
}

#msgInput {
  flex: 1;
  padding: 10px;
  border-radius: 20px;
  border: 1px solid #ccc;
}

#sendBtn {
  margin-left: 8px;
  padding: 10px 16px;
  border-radius: 20px;
  border: none;
  background: #0084ff;
  color: white;
}

/* ADMIN */
#adminBtn {
  position: fixed;
  bottom: 80px;
  right: 20px;
  padding: 12px;
  border-radius: 50%;
  background: black;
  color: white;
  cursor: pointer;
}

#adminPanel {
  display: none;
  position: fixed;
  top: 0;
  right: 0;
  width: 300px;
  height: 100%;
  background: #fff;
  border-left: 1px solid #ddd;
  padding: 10px;
  overflow-y: auto;
}
</style>
</head>

<body>

<!-- SCOREBOARD -->
<div id="scoreboard">
  <div class="teams">
    <div class="team">
      <img id="homeLogo">
      <div id="homeName">Home</div>
    </div>

    <div class="score">
      <span id="homeScore">0</span> - <span id="awayScore">0</span>
    </div>

    <div class="team">
      <img id="awayLogo">
      <div id="awayName">Away</div>
    </div>
  </div>
  <div id="middleInfo">Pre-Match</div>
</div>

<!-- TIMELINE -->
<div id="timeline"></div>

<!-- CHAT -->
<div id="chat"></div>

<div id="inputArea">
  <input id="msgInput" placeholder="Type a message...">
  <button id="sendBtn">SEND</button>
</div>

<div id="adminBtn">ADMIN</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <h3>Admin Panel</h3>

  <input id="homeTeamName" placeholder="Home Team Name"><br>
  <input id="homeTeamLogo" placeholder="Home Logo URL"><br><br>

  <input id="awayTeamName" placeholder="Away Team Name"><br>
  <input id="awayTeamLogo" placeholder="Away Logo URL"><br><br>

  <select id="stage">
    <option>Pre-match</option>
    <option>First half</option>
    <option>Half time</option>
    <option>Second half</option>
    <option>Full time</option>
  </select>
  <button onclick="updateStage()">Update Stage</button>

  <hr>

  <button onclick="addGoal('home')">Home Goal</button>
  <button onclick="addGoal('away')">Away Goal</button>
</div>

<script>
/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyA2AScPQkOE632znM9vvCahijtnronS3jU",
  authDomain: "fresherscuplive.firebaseapp.com",
  databaseURL: "https://fresherscuplive-default-rtdb.firebaseio.com",
  projectId: "fresherscuplive",
  storageBucket: "fresherscuplive.firebasestorage.app",
  messagingSenderId: "502451588704",
  appId: "1:502451588704:web:56bd4d7fc98814cddfbd05"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* USER */
let user = localStorage.getItem("user") || prompt("Your name?");
localStorage.setItem("user", user);

/* ADMIN */
document.getElementById("adminBtn").onclick = () => {
  const pass = prompt("Admin password");
  if (pass === "CPE2026") {
    document.getElementById("adminPanel").style.display = "block";
  }
};

function updateStage() {
  const stage = document.getElementById("stage").value;
  let info = stage;

  if (stage === "Pre-match") {
    const day = prompt("Match day?");
    const time = prompt("Match time?");
    info = day + " • " + time;
  }

  db.ref("match").update({
    stage: stage,
    middleInfo: info,
    homeName: homeTeamName.value,
    homeLogo: homeTeamLogo.value,
    awayName: awayTeamName.value,
    awayLogo: awayTeamLogo.value
  });
}

function addGoal(side) {
  const scorer = prompt("Goal scorer?");
  const minute = prompt("Minute?");
  db.ref("timeline").push({
    text: "⚽ " + scorer + " " + minute + "'",
    side: side
  });
  db.ref("match/" + side + "Score").transaction(n => (n || 0) + 1);
}

/* READ MATCH */
db.ref("match").on("value", s => {
  const d = s.val() || {};
  homeName.textContent = d.homeName || "Home";
  awayName.textContent = d.awayName || "Away";
  homeLogo.src = d.homeLogo || "";
  awayLogo.src = d.awayLogo || "";
  homeScore.textContent = d.homeScore || 0;
  awayScore.textContent = d.awayScore || 0;
  middleInfo.textContent = d.middleInfo || "";
});

/* TIMELINE */
db.ref("timeline").on("child_added", s => {
  const div = document.createElement("div");
  div.textContent = s.val().text;
  timeline.appendChild(div);
});

/* CHAT */
sendBtn.onclick = () => {
  if (!msgInput.value) return;
  db.ref("chat").push({ user, text: msgInput.value });
  msgInput.value = "";
};

db.ref("chat").on("value", s => {
  chat.innerHTML = "";
  s.forEach(c => {
    const d = c.val();
    const w = document.createElement("div");
    w.className = "message-wrap";
    const m = document.createElement("div");
    m.className = "msg " + (d.user === user ? "right" : "left");
    m.textContent = d.text;
    w.appendChild(m);
    chat.appendChild(w);
  });
  chat.scrollTop = chat.scrollHeight;
});
</script>

</body>
</html>
