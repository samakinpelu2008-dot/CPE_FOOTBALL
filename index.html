<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CPE Live Match</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial,sans-serif; }
body { background:#f0f2f5; height:100vh; display:flex; flex-direction:column; overflow:hidden; }

/* SCOREBOARD */
#scoreboard {
  background:#fff; padding:12px; border-bottom:1px solid #ddd; height:30%;
  display:flex; flex-direction:column; justify-content:space-between;
}
.teams {
  display:flex; justify-content:space-between; align-items:center;
}
.team { width:40%; text-align:center; }
.team img { width:50px; height:50px; border-radius:50%; object-fit:contain; transition:transform 0.3s ease; }
.team.winner img { transform: scale(1.3); }
.score { font-size:32px; font-weight:bold; }
#middleLine { position:relative; margin:10px 0; height:2px; background:#ccc; }
#middleLine::after { content:'⚽'; position:absolute; left:50%; top:-10px; transform:translateX(-50%); background:#f0f2f5; padding:2px 6px; border-radius:50%; }
#goalScorers { font-size:14px; margin-top:4px; }

/* FULL MATCH DETAILS */
#fullDetailsBtn { margin:6px auto; display:block; padding:6px 12px; cursor:pointer; border-radius:6px; border:none; background:#0084ff; color:white; }

/* TIMELINE */
#timeline { height:10%; background:#fff; padding:6px 10px; font-size:13px; overflow-y:auto; border-bottom:1px solid #ddd; }

/* CHAT */
#chatCard { flex:1; background:#f0f2f5; margin:6px; border-radius:12px; display:flex; flex-direction:column; overflow:hidden; }
#chat { flex:1; padding:10px; overflow-y:auto; }
.msgWrap { display:flex; margin:4px 0; }
.msg { padding:8px 12px; border-radius:16px; max-width:70%; word-break:break-word; }
.left { background:#fff; margin-right:auto; }
.right { background:#0084ff; color:#fff; margin-left:auto; }

/* INPUT */
#inputArea { display:flex; padding:6px; background:#fff; border-top:1px solid #ddd; }
#msgInput { flex:1; padding:8px 12px; border-radius:20px; border:1px solid #ccc; }
#sendBtn { margin-left:8px; padding:8px 16px; border-radius:20px; border:none; background:#0084ff; color:#fff; cursor:pointer; }

/* ADMIN */
#adminBtn { position:fixed; bottom:80px; right:20px; padding:12px; border-radius:50%; background:black; color:white; cursor:pointer; }
#adminPanel { display:none; max-height:40vh; overflow-y:auto; background:#fff; border-top:2px solid #000; padding:12px; }

.winner-glow { background:rgba(0,0,0,0.05); border-radius:14px; animation:pop 0.5s ease; }
@keyframes pop { from{transform:scale(0.9);} to{transform:scale(1);} }
</style>
</head>
<body>

<!-- SCOREBOARD -->
<div id="scoreboard">
  <div class="teams">
    <div class="team" id="homeBox">
      <img id="homeLogo" src="">
      <div id="homeName">Home</div>
    </div>
    <div class="score">
      <span id="homeScore">0</span> - <span id="awayScore">0</span>
    </div>
    <div class="team" id="awayBox">
      <img id="awayLogo" src="">
      <div id="awayName">Away</div>
    </div>
  </div>
  <div id="middleLine"></div>
  <div id="goalScorers"></div>
  <div id="matchTime" style="font-size:14px; color:#555;"></div>
</div>

<!-- FULL MATCH DETAILS BUTTON -->
<button id="fullDetailsBtn">FULL MATCH DETAILS</button>

<!-- TIMELINE -->
<div id="timeline"></div>

<!-- CHAT CARD -->
<div id="chatCard">
  <div id="chat"></div>
  <div id="inputArea">
    <input id="msgInput" placeholder="Type a message…">
    <button id="sendBtn">SEND</button>
  </div>
</div>

<!-- ADMIN BUTTON -->
<div id="adminBtn">ADMIN</div>
<div id="adminPanel">
  <h3>Admin Panel</h3>
  <input id="homeTeamName" placeholder="Home team name"><br>
  <input id="homeTeamLogo" placeholder="Home logo URL"><br><br>
  <input id="awayTeamName" placeholder="Away team name"><br>
  <input id="awayTeamLogo" placeholder="Away logo URL"><br><br>
  <button onclick="setTeams()">Set Teams</button>
  <hr>
  <select id="stage">
    <option value="pre">Pre-match</option>
    <option value="first">First Half</option>
    <option value="half">Half Time</option>
    <option value="second">Second Half</option>
    <option value="full">Full Time</option>
  </select>
  <button onclick="updateStage()">Update Stage</button>
  <hr>
  <button onclick="addGoal('home')">Home Goal</button>
  <button onclick="addGoal('away')">Away Goal</button>
  <hr>
  <button onclick="resetMatch()">RESET MATCH</button>
  <button onclick="resetChat()">RESET CHAT</button>
</div>

<script>
// Firebase init
firebase.initializeApp({
  apiKey: "AIzaSyBIUCbVIqFWIvas2DQI77TRdNEg4xvnkS8",
  authDomain: "cpefootball-934ed.firebaseapp.com",
  projectId: "cpefootball-934ed",
  storageBucket: "cpefootball-934ed.firebasestorage.app",
  messagingSenderId: "314240530293",
  appId: "1:314240530293:web:1c89774cda136f4661c53c"
});
const db = firebase.database();

/* USER */
let user = localStorage.getItem("user") || prompt("Your name?");
localStorage.setItem("user", user);

/* ADMIN BUTTON */
adminBtn.onclick = () => {
  if(prompt("Admin password") === "CPE2026"){
    adminPanel.style.display="block";
  }
};

/* TEAM SET */
function setTeams(){
  db.ref("match/teams").once("value", s=>{
    if(s.exists()) return alert("Teams already set. Use RESET MATCH.");
    db.ref("match/teams").set({
      home:{name:homeTeamName.value,logo:homeTeamLogo.value,score:0},
      away:{name:awayTeamName.value,logo:awayTeamLogo.value,score:0}
    });
  });
}

/* STAGE */
function updateStage(){
  const st = stage.value;
  if(st==="pre"){
    const d = prompt("Match day?");
    const t = prompt("Match time?");
    db.ref("match/stage").set({stage:"pre",info:d+" • "+t});
  }
  if(st==="first"){
    const mins = prompt("Minutes per half? (10/20/30/40)");
    db.ref("match/timer").set({start:Date.now(),half:1,limit:+mins});
    db.ref("match/stage").set({stage:"first"});
  }
  if(st==="full") db.ref("match/stage").set({stage:"full"});
}

/* GOAL */
function addGoal(side){
  const name = prompt("Scorer?");
  db.ref("match/teams/"+side+"/score").transaction(n=>(n||0)+1);
  db.ref("timeline").push("⚽ "+name);
}

/* RESET */
function resetMatch(){
  if(!confirm("Reset entire match?")) return;
  db.ref("match").remove();
  db.ref("timeline").remove();
}
function resetChat(){
  if(!confirm("Reset chat?")) return;
  db.ref("chat").remove();
}

/* READ MATCH */
db.ref("match").on("value", s=>{
  const d = s.val() || {};
  if(d.teams){
    homeName.textContent = d.teams.home.name;
    awayName.textContent = d.teams.away.name;
    homeLogo.src = d.teams.home.logo;
    awayLogo.src = d.teams.away.logo;
    homeScore.textContent = d.teams.home.score;
    awayScore.textContent = d.teams.away.score;
  }
  if(d.stage?.stage==="full"){
    (d.teams.home.score>d.teams.away.score?homeBox:awayBox).classList.add("winner-glow");
  }
  matchTime.textContent = d.stage?.info || d.stage?.stage || "";
});

/* TIMELINE */
db.ref("timeline").on("child_added", s=>{
  const div = document.createElement("div");
  div.textContent = s.val();
  timeline.appendChild(div);
  timeline.scrollTop = timeline.scrollHeight;
  // Update goal scorers
  goalScorers.textContent = Array.from(timeline.children).map(c=>c.textContent).join(", ");
});

/* CHAT */
sendBtn.onclick=()=>{
  if(!msgInput.value) return;
  db.ref("chat").push({u:user,t:msgInput.value});
  msgInput.value="";
};
db.ref("chat").on("value", s=>{
  chat.innerHTML="";
  s.forEach(c=>{
    const d=c.val();
    const w=document.createElement("div");
    w.className="msgWrap";
    const m=document.createElement("div");
    m.className="msg "+(d.u===user?"right":"left");
    m.textContent=d.t;
    m.onclick = ()=>{
      if(d.u===user && confirm("Delete your message?")) c.ref.remove();
    }
    w.appendChild(m);
    chat.appendChild(w);
  });
  chat.scrollTop = chat.scrollHeight;
});
</script>
</body>
</html>
